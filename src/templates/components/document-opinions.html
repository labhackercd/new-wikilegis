{% load staticfiles projects_tags participations_tags dashboard_tags %}

<article id="article" class="js-articleDocument" data-group-id={{group.id}}>
  <header>
    <div class="info">
      {% now "Y-m-d" as todays_date %}
      {% if group.closing_date|date:"Y-m-d" > todays_date %}
      <span class="date -active">Aberto até {{group.closing_date|date:'d/m/Y'}}</span>
      {% else %}
      <span class="date -inactive">Encerrado em {{group.closing_date|date:'d/m/Y'}}</span>
      {% endif %}
      <ul class="tags">
        <li class="app-tag">
          <img src="{% static 'img/public.svg' %}" alt="Participantes">
          <span class="label">{{participation_count}} Participantes</span>
        </li>
        <li class="app-tag">
          <img src="{% static 'img/given-opinions.svg' %}" alt="Opiniões">
          <span class="label">{{group.suggestions.count}} Opiniões</span>
        </li>
        <li class="app-tag">
          <img src="{% static 'img/votes.svg' %}" alt="Votos">
          <span class="label">{{group|group_votes}} Votos</span>
        </li>
      </ul>
    </div>
    <h1 class="js-documentTitle" contentEditable="true">{{ object.title }}</h1>
    <p class="js-documentDescription description">{{ object.description }}</p>
    <hr>
  </header>
  <canvas class="page-minimap js-pageMinimap"></canvas>
  {% for excerpt in group.get_excerpts %}
    {% if excerpt.excerpt_type.align_center %}
    <div class="excerpt-wrapper {% excerpt_classes excerpt%}">
      <h3 class="js-excerptNumbering">{% excerpt_numbering excerpt %}</h3>
      <h3>{{ excerpt.content|safe }}</h3>
    </div>
    {% else %}
      {% to_reduce group excerpt as reduce %}
      {% if reduce %}
      <p class="excerpt-wrapper {% excerpt_classes excerpt %} -reduce js-excerptWrapper">
        <b class="js-excerptNumbering">{% excerpt_numbering excerpt %}</b>
        <span class="js-defaultText">...</span>
        {% include "components/document-excerpt.html" with excerpt=excerpt %}
      </p>
      {% else %}
      <p class="excerpt-wrapper -analysis {% excerpt_classes excerpt %} js-excerptWrapper">
        <b class="js-excerptNumbering">{% excerpt_numbering excerpt %}</b>
        {% include "components/document-excerpt.html" with excerpt=excerpt %}
        <span class="metrics">
          <span class="item -votes">
            <span class="value">{{excerpt|excerpt_participants:group}}</span>
            <span class="bar">
              <span class="size" style="width: {% get_percent excerpt|excerpt_participants:group participation_count %}%;"></span>
            </span>
          </span>
          <span class="item -opinions">
            <span class="value">{{excerpt|excerpt_participants:group}}</span>
            <span class="bar">
              <span class="size" style="width: {% get_percent excerpt|excerpt_participants:group participation_count %}%;"></span>
            </span>
          </span>
          <span class="item -participants">
            <span class="value">{{excerpt|excerpt_participants:group}}</span>
            <span class="bar">
              <span class="size" style="width: {% get_percent excerpt|excerpt_participants:group participation_count %}%;"></span>
            </span>
          </span>
        </span>
      </p>
      {% endif %}
    {% endif %}
  {% endfor %}
</article>
