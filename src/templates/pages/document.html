{% extends "structure/base.html" %}
{% load staticfiles projects_tags participations_tags %}
{% block title %}
  {{ object.document.title }}
{% endblock title %}

{% block metatags %}
<meta name="description" content="{{ object.document.description }}">
<meta property="og:title" content="{{ object.document.title }}">
<meta property="og:site_name" content="Wikilegis">
<meta property="og:description" content="{{ object.document.description }}">
<meta property="og:image" content="{{ request.scheme }}://{{ request.META.HTTP_HOST }}{% static 'img/facebook-share-image.jpg' %}">
<meta property="og:image:type" content="image/jpg">
<meta property="og:image:width" content="600">
<meta property="og:image:height" content="300">
<meta property="og:type" content="website">
<meta property="og:type" content="website">
<meta property="twitter:image" content="{{ request.scheme }}://{{ request.META.HTTP_HOST }}{% static 'img/facebook-share-image.jpg' %}">
{% endblock metatags %}

{% block content %}

{% can_suggest object request.user as selection_enabled %}
<main class="document-body js-documentBody" data-selection-enabled="{% if selection_enabled %}true{% else %}false{% endif %}" data-group-id="{{ object.id }}">
  <div class="wrapper">
    <div class="invisible"></div>
    <aside class="info-bar">
      <div class="item">
        {% if object.document.document_type %}
        <span class="epigraph">{{ object.document.document_type.initials }} {{ object.document.number }}/{{ object.document.year }}</span>
        {% endif %}
      </div>
      {% if object.document.infos.authors.all %}
      <div class="item">
        <span class="title">Autor</span>
        {% for author in object.document.infos.authors.all %}
          {% if author.infos.cd_id %}
          <a class="autor" target="_blank" href="http://www2.camara.leg.br/deputados/pesquisa/layouts_deputados_biografia?pk={{author.infos.cd_id}}">
            <div class="info">
              <span class="text -name">{{ author.name }}</span>
              <span class="text">{{author.author_type}} {% if author.infos %}({{author.infos.party_initials}}-{{author.infos.uf}}){% endif %}</span>
            </div>
            {% if author.infos %}
            <img src="{{author.infos.image_url}}">
            {% endif %}
          </a>
          {% else %}
          <div class="autor">
            <div class="info">
              <span class="text -name">{{ author.name }}</span>
              <span class="text">{{author.author_type}} {% if author.infos.party_initials and author.infos.uf %}({{author.infos.party_initials}}-{{author.infos.uf}}){% endif %}</span>
            </div>
            {% if author.infos.image_url %}
            <img src="{{author.infos.image_url}}">
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}
      {% if object.document.infos.legislative_body and object.document.infos.status and object.document.infos.cd_id %}
      <a class="item" target="_blank" href="https://www.camara.leg.br/proposicoesWeb/fichadetramitacao?idProposicao={{object.document.infos.cd_id}}">
        <span class="title">Situação</span>
        <span class="text">{{ object.document.infos.legislative_body }} - {{ object.document.infos.status }}</span>
      </a>
      {% endif %}
      {% if object.document.themes.all %}
      <div class="item">
        <span class="title">Temas:</span>
        <ul class="themes">
          {% for theme in object.document.themes.all %}
            <li class="theme-tag">
              <span class="dot" style="background-color: {{theme.color}}"></span>
              {{ theme.name }}
            </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
      {% if object.document.videos.all %}
        {% for video in object.document.videos.all %}
        <div class="item -video">
          <iframe width="100%" src="https://www.youtube.com/embed/{{video.video_id}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        {% endfor %}
      {% endif %}
      <div class="item">
        <div class="social">
          <a class="facebook" data-social="facebook" title="Facebook" href="http://www.facebook.com/sharer/sharer.php?u={{request.build_absolute_uri}}" target="_blank" rel="noopener"></a>
          <a class="twitter" data-social="twitter" title="Twitter" href="http://twitter.com/share?text=Eu já estou participando, participe você também!&url={{request.build_absolute_uri}}" target="_blank" rel="noopener"></a>
          <a class="twitter" data-social="whatsapp" title="Whatsapp" href="https://api.whatsapp.com/send?text=Eu já estou participando, participe você também!%0A{{request.build_absolute_uri}}%20" target="_blank" rel="noopener"></a>
        </div>
      </div>
    </aside>
  </div>
  <article>
    <header>
      <div class="info">
        <div class="group">
          {% if object.closing_date|is_open %}
          <span class="date -active">Aberto até {{ object.closing_date|date:"d/m/Y" }}</span>
          {% else %}
          <span class="date -inactive">Encerrado em {{ object.closing_date|date:"d/m/Y" }}</span>
          {% endif %}
        </div>
      </div>
      <h1>{{ object.document.title }}</h1>
      <p class="description">{{ object.document.description }}</p>
      <hr>
      {% if request.user.is_authenticated %}
        {% group_suggestions object request.user as has_suggestions %}
      {% else %}
        {% group_suggestions object as has_suggestions %}
      {% endif %}
      {% if has_suggestions %}
      <span class="suggestion-opinion -all js-opinionButton">
        <i class="icon"></i>
        <span class="text">Ver opiniões</span>
      </span>
      {% endif %}
    </header>
    {% for excerpt in object.document.excerpts.all %}
      {% if excerpt.excerpt_type.align_center %}
      <h3>{% excerpt_numbering excerpt %}</h3>
      <h3>{{ excerpt.content|safe }}</h3>
      {% else %}
      <p class="js-excerptWrapper">
        <b>{% excerpt_numbering excerpt %}</b>
        {% include "components/document-excerpt.html" with excerpt=excerpt group=object %}
        {% if request.user.is_authenticated %}
          {% excerpt_suggestions object excerpt request.user as has_suggestions %}
        {% else %}
          {% excerpt_suggestions object excerpt as has_suggestions %}
        {% endif %}
        {% if has_suggestions %}
        <span class="suggestion-opinion js-opinionButton">
          <i class="icon"></i>
          <span class="text">Ver opiniões</span>
        </span>
        {% endif %}
      </p>
      {% endif %}
    {% endfor %}
  </article>
  <div class="info-button js-infoButton"></div>
</main>

{% include "components/suggestion-input.html" %}

{% include "components/opinion-modal.html" with suggestions=suggestions %}

{% include "components/info-modal.html" %}

{% include "components/opinion-onboarding.html" %}

{% include "components/text-selection-onboarding.html" %}
{% endblock content %}

{% block page_js %}
  <script src="{% static 'popper.js/dist/umd/popper.js' %}"></script>
  <script src="{% static 'tooltip.js/dist/umd/tooltip.js' %}"></script>
  <script src="{% static 'js/components/documentExcerpt/view.js' %}"></script>
  <script src="{% static 'js/components/documentBody/view.js' %}"></script>
  <script src="{% static 'js/components/infoButton/view.js' %}"></script>
  <script src="{% static 'js/components/infoModal/view.js' %}"></script>
  <script src="{% static 'js/components/suggestionInput/view.js' %}"></script>
  <script src="{% static 'js/components/suggestionInput/view.js' %}"></script>
  <script src="{% static 'js/components/suggestionInput/controller.js' %}"></script>
  <script src="{% static 'js/components/navBurger/view.js' %}"></script>
  <script src="{% static 'js/components/navBar/view.js' %}"></script>
  <script src="{% static 'js/components/body/view.js' %}"></script>
  <script src="{% static 'js/components/opinionModal/view.js' %}"></script>
  <script src="{% static 'js/components/opinionModal/controller.js' %}"></script>
  <script src="{% static 'js/components/textHighlight/view.js' %}"></script>
  <script src="{% static 'js/components/highlightTooltip/view.js' %}"></script>
  <script src="{% static 'js/components/opinionOnboarding/view.js' %}"></script>
  <script src="{% static 'js/components/textSelectionOnboarding/view.js' %}"></script>
  <script src="{% static 'js/pages/document.js' %}"></script>
{% endblock page_js %}
